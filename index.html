<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Mario Game</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #70c5ce; /* Light blue sky background */
        }

        #landingPage {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        canvas {
            display: none; /* Hide canvas initially */
        }

        .hidden {
            display: none; /* Class to hide elements */
        }
    </style>
</head>
<body>
    <div id="landingPage">
        <h1>Welcome to the Super Mario Game!</h1>
        <form id="startForm">
            <label for="playerName">Enter your name:</label>
            <input type="text" id="playerName" required />
            <br />
            <h3>Game Rules:</h3>
            <ul>
                <li>Use 'A' to move left.</li>
                <li>Use 'D' to move right.</li>
                <li>Press 'W' to jump.</li>
                <li>Avoid falling off the platforms!</li>
            </ul>
            <button type="button" id="nextButton">Next</button>
        </form>
        <button id="startButton" class="hidden">Start Game</button> <!-- Start button hidden initially -->
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.querySelector('canvas');
        const c = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const gravity = 1.5;
        const friction = 0.9;

        // Load platform image
        const platformImage = new Image();
        platformImage.src = 'platform.png'; // Ensure this path is correct

        // Load player images
        const standingImage = new Image();
        standingImage.src = 'standing.png'; // Ensure this path is correct

        const runningLeftImage = new Image();
        runningLeftImage.src = 'runningleft.png'; // Ensure this path is correct

        const runningRightImage = new Image();
        runningRightImage.src = 'runningright.png'; // Ensure this path is correct

        const groundHeight = 50; // Height of the ground
        const playerOffsetY = 10; // Offset to position player above the ground

        // Player object
        class Player {
            constructor() {
                this.position = { x: 100, y: canvas.height - groundHeight - this.height - playerOffsetY }; // Start position above the ground
                this.velocity = { x: 0, y: 0 };
                this.width = 66; // Width of the player
                this.widthr = 127.875 // when its running width
                this.height = 150; // Height of the player
                this.speed = 5; // Speed of the player
                this.jumpStrength = -20; // Jump strength
                this.isOnGround = false; // Flag to check if player is on the ground
                this.jumpCount = 0; // Track number of jumps for double jump
                this.facingLeft = false; // Track direction
                this.facingRight = false; // Track direction
            }

            draw() {
                if (this.facingLeft) {
                    c.drawImage(runningLeftImage, 0, 0, 340, 400, this.position.x, this.position.y, this.widthr, this.height); // Draw running left image with cropping
                } else if (this.facingRight) {
                    c.drawImage(runningRightImage, 0, 0, 340, 400, this.position.x, this.position.y, this.widthr, this.height); // Draw running right image with cropping
                } else {
                    c.drawImage(standingImage, 0, 0, 177, 400, this.position.x, this.position.y, this.width, this.height); // Draw standing image with cropping
                }
            }

            update() {
                this.draw();

                // Update player position based on velocity
                this.position.x += this.velocity.x;
                this.position.y += this.velocity.y;

                // Handle gravity
                if (this.position.y + this.height + this.velocity.y <= canvas.height - groundHeight) {
                    this.velocity.y += gravity;
                    this.isOnGround = false; // Player is falling
                } else {
                    this.velocity.y = 0; // Stop falling
                    this.isOnGround = true; // Player is on the ground
                    this.jumpCount = 0; // Reset jump count when touching ground

                    // Set player's y position to be on top of the ground with offset
                    this.position.y = canvas.height - groundHeight - this.height - playerOffsetY; 
                }
            }

            move(keys) {
                if (keys.right.pressed) {
                    this.velocity.x = this.speed;
                    this.facingLeft = false; // Not facing left when moving right
                    this.facingRight = true; // Facing right when moving right
                    if (this.position.x > canvas.width / 2) {
                        platforms.forEach(platform => platform.position.x -= this.speed); // Scroll platforms left

                        // Add new platforms dynamically when reaching certain positions
                        if (this.position.x > platforms[platforms.length - 1].position.x - 200) {
                            const newPlatformX = platforms[platforms.length - 1].position.x + Math.random() * 300 + 100; // Random position for new platform
                            const newPlatformY = Math.random() * (canvas.height - groundHeight - 200) + 50; // Random height for new platform
                            platforms.push(new Platform(newPlatformX, newPlatformY, 200, 20)); // Add new platform
                        }
                    }
                } else if (keys.left.pressed) {
                    this.velocity.x = -this.speed;
                    this.facingLeft = true; // Facing left when moving left
                    this.facingRight = false; // Not facing right when moving left
                } else {
                    this.velocity.x *= friction; // Apply friction to stop player when keys are not pressed
                    if (!this.isOnGround) { 
                        this.facingLeft = false; 
                        this.facingRight = false; 
                    }
                }

                // Jump logic (double jump)
                if (keys.up.pressed) {
                    if (this.isOnGround) { 
                        this.velocity.y = this.jumpStrength; // Normal jump
                        this.isOnGround = false; 
                        this.jumpCount++; 
                    } else if (this.jumpCount === 1) { 
                        this.velocity.y = -30; // Higher double jump
                        this.jumpCount++; 
                    }
                }
            }
        }

        // Platform object
        class Platform {
            constructor(x, y, width, height) {
                this.position = { x, y };
                this.width = width;
                this.height = height;
            }

            draw() {
                c.drawImage(platformImage, this.position.x, this.position.y, this.width, this.height); // Draw platform image
            }
        }

        const player = new Player();
        const platforms = [
            new Platform(200, canvas.height - groundHeight - 100, 200, 20), // Floating platform above the ground
            new Platform(500, canvas.height - groundHeight - 200, 200, 20), // Floating platform above the ground
        ];

        const keys = {
            right: { pressed: false },
            left: { pressed: false },
            up: { pressed: false },
        };

        function drawGround() {
            c.fillStyle = 'pink'; // Set the color for the ground
            c.fillRect(0, canvas.height - groundHeight, canvas.width, groundHeight); // Draw the ground rectangle at the bottom of the canvas
        }

        function animate() {
            requestAnimationFrame(animate);
            c.clearRect(0, 0, canvas.width, canvas.height);

            drawGround(); // Draw the pink ground first

            player.update();
            player.move(keys);

            platforms.forEach(platform => {
                platform.draw();
                
                if (player.position.y + player.height <= platform.position.y &&
                    player.position.y + player.height + player.velocity.y >= platform.position.y &&
                    player.position.x + player.width >= platform.position.x &&
                    player.position.x < platform.position.x + platform.width) {
                    player.velocity.y = 0;
                    player.position.y = platform.position.y - player.height; 
                    player.isOnGround = true; 
                    player.jumpCount = 0;

                    if (player.position.y < platform.position.y - player.height) {
                        player.position.y = platform.position.y - player.height; 
                    }
                }
            });
        }

        document.getElementById('nextButton').addEventListener('click', () => {
          document.getElementById('startForm').classList.add('hidden'); // Hide form elements after clicking Next
          document.getElementById('startButton').classList.remove('hidden'); // Show Start button
      });

      document.getElementById('startButton').addEventListener('click', () => {
          document.getElementById('landingPage').classList.add('hidden'); // Hide landing page completely including form and buttons
          document.querySelector('canvas').style.display = 'block'; // Show canvas for game

          startGame(); // Start game after clicking start button
      });

      function startGame() {
          animate(); // Start animation loop for game
          addEventListeners(); // Add event listeners for controls
      }

      function addEventListeners() {
        addEventListener('keydown', (event) => {
    const { keyCode } = event
    switch (keyCode) {
        case 65: // 'A' key for left
            keys.left.pressed = true
            break

        case 68: // 'D' key for right
            keys.right.pressed = true
            break

        case 87: // 'W' key for jump
            if (player.isOnGround) { // Only allow jumping when grounded
                console.log('up')
                player.velocity.y -= 20
                player.isOnGround = false
            }
            break
    }
})

addEventListener('keyup', (event) => {
    const { keyCode } = event
    switch (keyCode) {
        case 65: // 'A' key for left
            keys.left.pressed = false
            break

        case 68: // 'D' key for right
            keys.right.pressed = false
            break

        case 87: // 'W' key for jump
            break // No need to handle jump in keyup
    }
})}
    </script>
</body>
</html>
